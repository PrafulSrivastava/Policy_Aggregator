# Story 5.1: Source Research & Identification for New Routes

## Status
Ready for Review

## Story
**As a** developer,  
**I want** to research and document official immigration sources for new country pairs,  
**so that** I can identify reliable, scrapable sources before implementing fetchers.

## Acceptance Criteria

1. Research completed for 1-2 new country pairs (e.g., India → UK, India → Canada)
2. Document for each new route:
   - Official government immigration websites
   - PDF policy documents and circulars
   - Embassy/consulate sources
   - Ministry of immigration sources
3. For each source, document:
   - URL and access method
   - Content structure (HTML, PDF, API)
   - Update frequency (if known)
   - Scraping feasibility assessment
4. Legal/compliance review:
   - Verify public accessibility
   - Check robots.txt and terms of service
   - Document any restrictions or requirements
5. Source prioritization: Identify 3-5 highest-priority sources per route
6. Documentation: Create source inventory document with all findings
7. Validation: Test manual access to all identified sources

## Tasks / Subtasks

- [x] Task 1: Research new country pairs (AC: 1)
  - [x] Identify 1-2 new routes to expand (e.g., India → UK, India → Canada)
  - [x] Consider market demand and customer requests
  - [x] Document route selection rationale
- [x] Task 2: Research official government sources (AC: 2)
  - [x] For each new route, identify:
    - [x] Official government immigration websites
    - [x] PDF policy documents and circulars
    - [x] Embassy/consulate sources
    - [x] Ministry of immigration sources
  - [x] Document source URLs and access methods
  - [x] Note source language and content format
- [x] Task 3: Document source technical details (AC: 3)
  - [x] For each identified source, document:
    - [x] URL and access method (direct URL, requires navigation, etc.)
    - [x] Content structure (HTML, PDF, API, etc.)
    - [x] Update frequency (if known or observable)
    - [x] Scraping feasibility assessment (easy, moderate, difficult)
  - [x] Note any special requirements (authentication, cookies, etc.)
- [x] Task 4: Legal/compliance review (AC: 4)
  - [x] Verify public accessibility of each source
  - [x] Check robots.txt for each source domain
  - [x] Review terms of service for each source
  - [x] Document any restrictions or requirements
  - [x] Note any legal concerns or compliance requirements
- [x] Task 5: Source prioritization (AC: 5)
  - [x] Evaluate sources based on:
    - [x] Reliability and official status
    - [x] Update frequency
    - [x] Scraping feasibility
    - [x] Content completeness
  - [x] Identify 3-5 highest-priority sources per route
  - [x] Document prioritization rationale
- [x] Task 6: Create source inventory document (AC: 6)
  - [x] Create `docs/sources/source-inventory-{route}.md` for each new route
  - [x] Document all findings in structured format:
    - [x] Route information (origin, destination, visa types)
    - [x] Source list with all documented details
    - [x] Prioritization results
    - [x] Legal/compliance notes
  - [x] Include source URLs, access methods, and technical assessments
- [x] Task 7: Validate source access (AC: 7)
  - [x] Test manual access to all identified sources
  - [x] Verify URLs are accessible and current
  - [x] Test content retrieval (download PDFs, access HTML pages)
  - [x] Document any access issues or changes
  - [x] Update source inventory with validation results

## Dev Notes

### Previous Story Insights
- Story 2.1 established the plugin architecture for source fetchers
- Story 2.2 and 2.3 implemented HTML and PDF fetchers that can be reused
- Story 2.10 created source fetchers for India → Germany route as a reference
- The fetcher architecture supports any country/visa type combination

### Fetcher Architecture
[Source: docs/fetchers/README.md]

**Fetcher Naming Convention:**
- Format: `{country}_{agency}_{visa_type}.py`
- Example: `uk_home_office_student.py` for UK Home Office Student visa
- Country: 2-letter ISO country code (lowercase)
- Agency: Government agency abbreviation (lowercase, underscores allowed)
- Visa type: Visa type identifier (lowercase, underscores allowed)

**Fetcher Interface:**
- All fetchers implement: `fetch(url: str, metadata: Dict[str, Any]) -> FetchResult`
- Returns `FetchResult` with raw text, content type, timestamp, and metadata
- Supports HTML and PDF content types

**Fetcher Types:**
- HTML fetchers: Use `requests` and `BeautifulSoup` for scraping
- PDF fetchers: Use `pdftotext` or `PyPDF2`/`pdfplumber` for extraction

### Source Model
[Source: docs/architecture/data-models.md]

**Source Attributes:**
- `country`: string (2-char country code, e.g., "UK", "CA")
- `visaType`: string (e.g., "Student", "Work")
- `url`: string (source URL to fetch from)
- `fetchType`: "html" | "pdf" (how to fetch content)
- `name`: string (human-readable name)
- `isActive`: boolean (whether currently monitored)

**Source Configuration:**
- Sources are stored in database with country, visa_type, and URL
- Route-to-source mapping uses country and visa_type matching
- Multiple sources can monitor the same route (redundancy)

### Route-to-Source Mapping
[Source: docs/stories/3.1.route-to-source-mapping-logic.story.md]

**Mapping Logic:**
- Routes match sources by `destination_country == source.country`
- Routes match sources by `visa_type == source.visa_type`
- Origin country is not used in matching (sources are destination-specific)
- Many-to-many relationship (one source can serve multiple routes)

### File Locations
[Source: docs/architecture/unified-project-structure.md]

Files to create:
- `docs/sources/source-inventory-{route}.md` - Source inventory documents for each new route
- Example: `docs/sources/source-inventory-india-uk.md`
- Example: `docs/sources/source-inventory-india-canada.md`

### Coding Standards
[Source: docs/architecture/coding-standards.md]

**Documentation:**
- All research findings must be documented clearly
- Source inventory should be structured and easy to reference
- Include URLs, access methods, and technical assessments

**Legal Compliance:**
- Always verify public accessibility
- Respect robots.txt and terms of service
- Document any restrictions or requirements

### Testing Requirements
[Source: docs/architecture/testing-strategy.md]

**Validation Testing:**
- Manual testing of all identified sources
- Verify URLs are accessible
- Test content retrieval methods
- Document any access issues

### Technical Constraints
- Sources must be publicly accessible (no authentication required for MVP)
- Sources should be official government sources (reliability)
- Content must be scrapable with existing fetcher types (HTML or PDF)
- Sources should update regularly to provide value

### Research Guidelines
- Prioritize official government sources over third-party sources
- Verify source reliability and official status
- Consider update frequency and content completeness
- Assess scraping feasibility before implementation
- Document all findings for future reference

## Testing

**Manual Testing:**
- Test manual access to all identified sources
- Verify URLs are current and accessible
- Test content retrieval (download PDFs, access HTML pages)
- Document any access issues or changes

**Validation:**
- Review source inventory document for completeness
- Verify all required information is documented
- Check that prioritization is justified
- Confirm legal/compliance review is complete

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (via Cursor)

### File List
- `docs/sources/source-inventory-india-uk.md` - Source inventory for India → UK route (NEW)
- `docs/sources/source-inventory-india-canada.md` - Source inventory for India → Canada route (NEW)
- `docs/sources/` - Directory created for source inventory documents (NEW)

### Completion Notes List
- ✅ Completed research for 2 new country pairs: India → UK and India → Canada
- ✅ Identified and documented 5 official sources for India → UK route:
  - UK Home Office Student Visa page (Priority 1)
  - UK Home Office Skilled Worker Visa page (Priority 2)
  - UK Immigration Rules guidance (Priority 3)
  - UK Visas and Immigration application guidance (Priority 4)
  - UK Home Office policy papers (Priority 5)
- ✅ Identified and documented 5 official sources for India → Canada route:
  - IRCC Study Permit page (Priority 1)
  - IRCC Work in Canada page (Priority 2)
  - IRCC Operational Bulletins and Manuals (Priority 3)
  - IRCC News and Updates (Priority 4)
  - IRCC Program Delivery Updates (Priority 5)
- ✅ Documented technical details for all sources (URL, structure, feasibility, update frequency)
- ✅ Completed legal/compliance review: All sources publicly accessible, robots.txt allows crawling, no restrictions identified
- ✅ Prioritized sources (3-5 per route) based on reliability, update frequency, scraping feasibility, and content completeness
- ✅ Created comprehensive source inventory documents with all required information
- ✅ Validated source access: All URLs tested and confirmed accessible (2025-01-27)
- ✅ All acceptance criteria met

### Debug Log References
N/A - No debugging required for research/documentation task

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2025-01-27 | 1.1 | Story implementation completed - Research and documentation for India → UK and India → Canada routes | James (Dev Agent) |

