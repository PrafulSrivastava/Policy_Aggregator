# Story 4.34: User Signup/Registration Flow

## Status
Draft

## Story
**As a** new user,  
**I want** to create an account with email and password,  
**so that** I can access the application and manage my routes and sources.

## Acceptance Criteria

1. Signup page accessible via /#/signup route
2. Signup form includes:
   - Email address input (used as username)
   - Password input
   - Confirm password input
   - Terms and conditions checkbox (required)
3. Form validation:
   - Email format validation
   - Password strength requirements (minimum 8 characters, or as per backend)
   - Password confirmation match
   - Required fields validation
4. Calls `POST /api/auth/signup` endpoint to create account
5. Success: Account created, user logged in automatically, redirect to dashboard
6. Error handling:
   - Email already exists error
   - Validation errors displayed inline
   - Network errors handled gracefully
7. Loading state during signup
8. Link to login page ("Already have an account? Sign in")
9. Design system styling applied (Minimalist Monochrome)
10. User receives confirmation (visual feedback on success)

## Tasks / Subtasks

- [x] Task 1: Create backend signup endpoint (AC: 4)
  - [x] Create `POST /api/auth/signup` endpoint in `api/routes/auth.py`
  - [x] Accept: email, password, confirm_password (optional, can validate on frontend)
  - [x] Validate email format
  - [x] Validate password strength
  - [x] Check if email already exists
  - [x] Hash password using bcrypt
  - [x] Create user in database
  - [x] Generate JWT token
  - [x] Return token and user info
  - [x] Handle duplicate email error (409 Conflict)
- [x] Task 2: Create signup request/response schemas (AC: 4)
  - [x] Create `SignupRequest` schema in `api/models/schemas/user.py`
  - [x] Create `SignupResponse` schema (can reuse LoginResponse)
  - [x] Add validation rules (email format, password length)
- [x] Task 3: Create signup page component (AC: 1, 2, 9)
  - [x] Create `src/pages/Signup.tsx`
  - [x] Create signup form with:
    - [x] Email input field
    - [x] Password input field
    - [x] Confirm password input field
    - [x] Terms and conditions checkbox
  - [x] Apply design system styling
  - [x] Add route: /#/signup
- [x] Task 4: Implement form validation (AC: 3)
  - [x] Client-side email format validation
  - [x] Password strength validation (minimum 8 characters)
  - [x] Password confirmation match validation
  - [x] Required fields validation
  - [x] Terms checkbox validation
  - [x] Show inline error messages
- [x] Task 5: Create signup service (AC: 4, 6)
  - [x] Add `signup(email, password)` function to `src/services/api.ts`
  - [x] Call `POST /api/auth/signup` endpoint
  - [x] Handle success response (store token, return user)
  - [x] Handle error responses:
    - [x] 409 Conflict (email exists)
    - [x] 400 Bad Request (validation errors)
    - [x] Network errors
- [x] Task 6: Implement signup flow (AC: 5, 7, 10)
  - [x] Handle form submission
  - [x] Show loading state during API call
  - [x] On success:
    - [x] Store JWT token
    - [x] Update auth context
    - [x] Show success message
    - [x] Redirect to dashboard
  - [x] On error:
    - [x] Display error message
    - [x] Handle field-specific errors
- [x] Task 7: Add navigation links (AC: 8)
  - [x] Add "Sign up" link to login page
  - [x] Add "Sign in" link to signup page
  - [x] Style links according to design system
- [ ] Task 8: Create unit tests (AC: All)
  - [ ] Test signup service
  - [ ] Test signup form validation
  - [ ] Test signup page component
  - [ ] Test error handling
- [ ] Task 9: Manual testing (AC: All)
  - [ ] Test creating account with valid data
  - [ ] Test email validation
  - [ ] Test password strength validation
  - [ ] Test duplicate email error
  - [ ] Test terms checkbox requirement
  - [ ] Test automatic login after signup
  - [ ] Test redirect to dashboard

## Dev Notes

### Previous Story Insights
- Story 4.10 created login page and authentication foundation
- Story 1.5 created password hashing and JWT token generation
- User model exists with username, hashed_password, is_active fields
- No signup endpoint exists yet (needs backend implementation)

### API Specifications
[Source: architecture/api-specification.md]

**Signup Endpoint (To Create):**
- `POST /api/auth/signup` - Create new user account
- Request body:
  ```json
  {
    "email": "user@example.com",
    "password": "securepassword123"
  }
  ```
- Response: 201 Created with `{access_token, token_type: "bearer", user: {...}}`
- Error responses:
  - 400 Bad Request: Validation error
  - 409 Conflict: Email already exists

**Password Requirements:**
- Minimum 8 characters (or as per backend configuration)
- Can add complexity requirements (uppercase, lowercase, numbers, symbols)

### Frontend Architecture
[Source: architecture/frontend-architecture.md]

**Component Structure:**
- Page component: `src/pages/Signup.tsx`
- Service: `src/services/auth.ts` (update existing)
- Reusable form components from story 4.12

### Design System
[Source: .ignore/design_prompt.md]

**Form Styling:**
- 2px solid black border (bottom only) for inputs
- Sharp corners (no border-radius)
- Black background, white text for submit button
- Checkbox: sharp corners, black border

### File Locations
- `api/routes/auth.py` - Add signup endpoint
- `api/models/schemas/user.py` - Add SignupRequest schema
- `frontend/src/pages/Signup.tsx` - Create signup page
- `frontend/src/services/auth.ts` - Add signup function
- `frontend/src/pages/Login.tsx` - Add "Sign up" link

### Coding Standards
[Source: architecture/coding-standards.md]

**Security:**
- Password must be hashed using bcrypt (same as login)
- Never log passwords
- Validate email format on both client and server
- Check for duplicate emails before creating user

### Testing Requirements
[Source: architecture/testing-strategy.md]

**Test File Location:**
- Backend: `tests/integration/test_api/test_auth.py`
- Frontend: `frontend/src/__tests__/pages/Signup.test.tsx`

**Test Cases:**
- Test signup with valid data
- Test duplicate email error
- Test password validation
- Test email format validation
- Test automatic login after signup

### Technical Constraints
- Must use existing password hashing (bcrypt)
- Must use existing JWT token generation
- Must integrate with existing auth context
- Must handle duplicate email gracefully
- Terms checkbox must be required

## Testing

### Testing Standards
[Source: architecture/testing-strategy.md]

**Test File Location:**
- Backend: `tests/integration/test_api/test_auth.py`
- Frontend: `frontend/src/__tests__/pages/Signup.test.tsx`

**Test Standards:**
- Use pytest for backend tests
- Use React Testing Library for frontend tests
- Mock API responses for frontend tests
- Test all validation scenarios
- Test error handling

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Initial story creation | Scrum Master |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Completion Notes List
- Backend signup endpoint implemented with full validation and error handling
- Signup schemas created with proper Pydantic validation
- Frontend signup page created with comprehensive form validation
- Signup service integrated into API client and AuthContext
- Navigation links added between login and signup pages
- All form validation requirements implemented (email format, password strength, password match, terms checkbox)
- Error handling implemented for all error scenarios
- Automatic login and redirect to dashboard on successful signup

### File List
**Backend:**
- `api/routes/auth.py` - Added signup endpoint
- `api/models/schemas/user.py` - Added SignupRequest and SignupResponse schemas
- `tests/integration/test_api/test_auth.py` - Added signup endpoint tests

**Frontend:**
- `frontend/pages/Signup.tsx` - Created signup page component
- `frontend/services/api.ts` - Added signup function to API client
- `frontend/context/AuthContext.tsx` - Added signup function to auth context
- `frontend/types/api.ts` - Added SignupRequest, SignupResponse, and UserInfo types
- `frontend/App.tsx` - Added /signup route
- `frontend/pages/Login.tsx` - Added "Sign up" navigation link

### Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Initial story creation | Scrum Master |
| 2025-12-30 | 1.1 | Backend and frontend implementation completed | Dev Agent |

## QA Results
_To be populated by QA Agent_

