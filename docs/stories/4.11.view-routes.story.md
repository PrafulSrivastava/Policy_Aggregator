# Story 4.11: View Routes

## Status
Ready for Review

## Story
**As an** authenticated user,  
**I want** to see all routes I own,  
**so that** I can manage them.

## Acceptance Criteria

1. Calls `GET /api/routes` endpoint to fetch routes
2. Only user-owned routes are returned (backend enforces this)
3. Routes displayed in a table or list view
4. Empty state is handled explicitly (show message when no routes exist)
5. Loading state shown while fetching routes
6. Error state shown if API call fails
7. Pagination supported if backend returns paginated results
8. Route information displayed: origin country, destination country, visa type, email, created date
9. Actions available: Edit, Delete (will be implemented in later stories)
10. User data isolation: Frontend never displays another user's routes

## Tasks / Subtasks

- [x] Task 1: Create routes service (AC: 1)
  - [x] Create `src/services/routes.js`
  - [x] Implement `getRoutes(page, pageSize)` function
    - [x] Call `GET /api/routes?page={page}&page_size={pageSize}`
    - [x] Handle pagination parameters
    - [x] Return routes data with pagination metadata
  - [x] Implement error handling for API failures
- [x] Task 2: Create routes list page component (AC: 3, 4, 5, 6, 8)
  - [x] Create `src/pages/Routes.js` or `src/pages/routes/List.js`
  - [x] Implement route fetching on component mount
  - [x] Display routes in table format:
    - [x] Columns: Origin, Destination, Visa Type, Email, Created Date, Actions
    - [x] Use design system components (Table, Button)
  - [x] Implement loading state (skeleton loader or spinner)
  - [x] Implement error state (error message with retry button)
  - [x] Implement empty state:
    - [x] Show message: "No routes configured yet"
    - [x] Show "Add Your First Route" button (links to add route page)
  - [x] Apply Minimalist Monochrome design system
- [x] Task 3: Create route list item component (AC: 8, 9)
  - [x] Create `src/components/routes/RouteListItem.js` or use table row
  - [x] Display route information:
    - [x] Origin country → Destination country format
    - [x] Visa type
    - [x] Email address
    - [x] Created date (formatted: YYYY-MM-DD)
  - [x] Add action buttons (Edit, Delete) - disabled for now, will be wired in later stories
  - [x] Style according to design system
- [x] Task 4: Implement pagination (AC: 7)
  - [x] Create `src/components/Pagination.js` component
  - [x] Display pagination controls:
    - [x] Previous/Next buttons
    - [x] Page numbers
    - [x] Total count: "Showing X of Y routes"
  - [x] Handle page changes (update URL params or state)
  - [x] Fetch new page of routes on page change
  - [x] Disable Previous on first page, Next on last page
- [x] Task 5: Add route to navigation (AC: All)
  - [x] Update navigation component to include "Routes" link
  - [x] Link points to `/routes` route
  - [x] Highlight active route in navigation
- [x] Task 6: Create unit tests (AC: All)
  - [x] Test routes service API calls
  - [x] Test routes list component rendering
  - [x] Test loading state display
  - [x] Test error state display
  - [x] Test empty state display
  - [x] Test pagination component
- [ ] Task 7: Manual testing (AC: All)
  - [ ] Test viewing routes list with existing routes
  - [ ] Test empty state (no routes)
  - [ ] Test loading state (slow network)
  - [ ] Test error state (API failure)
  - [ ] Test pagination (if multiple pages)
  - [ ] Verify only user's routes are displayed

## Dev Notes

### Previous Story Insights
- Story 4.10 created React foundation and authentication
- Story 1.6 created RouteSubscription API endpoints
- Backend endpoint: `GET /api/routes?page=1&page_size=20`
- Response format: `{items: [...], total: N, page: 1, page_size: 20}`
- All endpoints require authentication (JWT token)

### API Specifications
[Source: architecture/api-specification.md]

**Routes Endpoint:**
- `GET /api/routes` - List route subscriptions (paginated)
- Query parameters: `page` (default: 1), `page_size` (default: 20, max: 100)
- Response: `{items: [RouteSubscription], total: int, page: int, page_size: int}`
- RouteSubscription schema:
  ```json
  {
    "id": "uuid",
    "origin_country": "IN",
    "destination_country": "DE",
    "visa_type": "Student",
    "email": "user@example.com",
    "is_active": true,
    "created_at": "2025-01-27T10:00:00Z",
    "updated_at": "2025-01-27T10:00:00Z"
  }
  ```

**Authentication:**
- Requires Bearer token in Authorization header
- Returns 401 if not authenticated

### Frontend Architecture
[Source: architecture/frontend-architecture.md]

**Component Structure:**
- Page component: `src/pages/routes/List.js`
- Service: `src/services/routes.js`
- Reusable components: Table, Pagination, LoadingSpinner, ErrorMessage, EmptyState

**State Management:**
- Use React useState for routes data, loading, error states
- Use React useEffect for data fetching on mount
- No global state needed (can use Context if needed later)

### Design System
[Source: .ignore/design_prompt.md]

**Table Styling:**
- Sharp corners (border-radius: 0)
- Black borders (1px solid #000000)
- Alternating row backgrounds (subtle gray)
- Monospace font for dates/metadata
- Hover state: subtle background change

**Empty State:**
- Centered message
- Large, clear typography
- Call-to-action button (black background, white text)

### File Locations
[Source: architecture/unified-project-structure.md]

**Files to Create:**
- `frontend/src/pages/routes/List.js` - Routes list page
- `frontend/src/services/routes.js` - Routes API service
- `frontend/src/components/routes/RouteListItem.js` - Route item component (optional)
- `frontend/src/components/Pagination.js` - Reusable pagination component
- `frontend/src/components/LoadingSpinner.js` - Loading indicator
- `frontend/src/components/ErrorMessage.js` - Error display component
- `frontend/src/components/EmptyState.js` - Empty state component

### Coding Standards
[Source: architecture/coding-standards.md]

**React Patterns:**
- Use functional components with hooks
- Use async/await for API calls
- Handle loading and error states explicitly
- Never assume data exists (check for null/undefined)

**API Client:**
- Use API service from Task 1 (from story 4.10)
- Attach auth token automatically via interceptor
- Handle 401 errors (redirect to login)

### Testing Requirements
[Source: architecture/testing-strategy.md]

**Test File Location:** `frontend/src/__tests__/pages/routes/List.test.js`

**Test Cases:**
- Test routes service API call
- Test component renders loading state
- Test component renders routes list
- Test component renders empty state
- Test component renders error state
- Test pagination component
- Mock API responses using MSW or jest.mock

### Technical Constraints
- Must consume only `GET /api/routes` endpoint
- Must not re-implement backend logic
- Must handle pagination if backend returns paginated results
- Must enforce user data isolation (backend handles this, but frontend must never display wrong data)
- Must show explicit empty state (not just blank page)
- Must show loading state for all API calls
- Must show error state for failed API calls

### Cross-Cutting Requirements
**User Data Isolation:**
- Backend returns only user's routes
- Frontend must never display another user's routes
- If frontend displays another user's route, that is a severity-1 bug

**State & Feedback Discipline:**
- Loading state: Show spinner or skeleton loader
- Success state: Display routes list
- Failure state: Show error message with retry option
- Silent failures are not acceptable

**Frontend Is Driven by Backend Reality:**
- No hardcoded route data
- Render what API returns
- Handle missing fields gracefully

## Testing

### Testing Standards
[Source: architecture/testing-strategy.md]

**Test File Location:** `frontend/src/__tests__/pages/routes/List.test.js`

**Test Standards:**
- Use React Testing Library
- Mock API responses
- Test all states: loading, success, error, empty
- Test user interactions (pagination clicks)

**Testing Frameworks:**
- Jest with React Testing Library
- MSW for API mocking

**Specific Testing Requirements:**
- Test routes list rendering
- Test pagination functionality
- Test loading state
- Test error handling
- Test empty state
- Test API service error handling

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Initial story creation | Scrum Master |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Debug Log References
_No debug log entries required_

### Completion Notes List
- Routes service created with pagination support and error handling
- Routes list page component with table view, loading, error, and empty states
- Reusable components created: LoadingSpinner, ErrorMessage, EmptyState, Pagination
- Table displays all required route information: origin → destination, visa type, email, created date, status
- Pagination component with Previous/Next buttons, page numbers, and item count display
- Navigation component updated to highlight active route
- URL-based pagination (page and page_size in query params)
- Edit and Delete action buttons added (disabled, ready for future stories)
- All components styled according to Minimalist Monochrome design system
- Comprehensive unit tests for all components and services
- All core functionality implemented and ready for manual testing

### File List
**New Files Created:**
- `frontend/src/services/routes.ts` - Routes API service with pagination support
- `frontend/src/components/LoadingSpinner.tsx` - Loading indicator component
- `frontend/src/components/ErrorMessage.tsx` - Error message component with retry functionality
- `frontend/src/components/EmptyState.tsx` - Empty state component with optional action button
- `frontend/src/components/Pagination.tsx` - Pagination component with page controls
- `frontend/src/__tests__/services/routes.test.ts` - Routes service unit tests
- `frontend/src/__tests__/components/LoadingSpinner.test.tsx` - LoadingSpinner component tests
- `frontend/src/__tests__/components/ErrorMessage.test.tsx` - ErrorMessage component tests
- `frontend/src/__tests__/components/EmptyState.test.tsx` - EmptyState component tests
- `frontend/src/__tests__/components/Pagination.test.tsx` - Pagination component tests
- `frontend/src/__tests__/pages/Routes.test.tsx` - Routes page component tests

**Modified Files:**
- `frontend/src/pages/Routes.tsx` - Updated from placeholder to full routes list implementation
- `frontend/src/components/Navigation.tsx` - Added active route highlighting

## QA Results
_To be populated by QA Agent_

